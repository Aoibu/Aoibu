<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>حلقة المحقق كونان</title>
  <style>
    body { background-color: #111; color: #fff; font-family: 'Tahoma', sans-serif; margin: 0; }
    .banner { background: #1a1a1a; padding: 15px; text-align: center; font-size: 18px; font-weight: bold; border-bottom: 1px solid #333; }
    .container { display: flex; min-height: 100vh; }
    .sidebar, .episodes-list { width: 22%; background: #1a1a1a; padding: 20px; box-shadow: inset 0 0 1px #333; }
    .content { width: 56%; padding: 20px; background: #121212; }
    .video-player iframe { width: 100%; height: 400px; border: none; }
    .download-table, .subtitles { margin-top: 20px; width: 100%; }
    .download-table th, .download-table td { border: 1px solid #333; padding: 8px; text-align: center; }
    .download-table th { background: #222; }
    .server-buttons { text-align: center; margin: 15px 0; }
    .server-buttons button { background: #222; color: #00bcd4; padding: 8px 16px; border: 1px solid #333; margin: 5px; cursor: pointer; border-radius: 4px; }
    .server-buttons button:hover { background: #00bcd4; color: #111; }
    .subtitles a { display: block; color: #ccc; margin: 5px 0; }
    .subtitles a:hover { color: #fff; }
  </style>
</head>
<body>

<div class="banner">فريق ترجمة أويبو - Aoibu Team</div>

<div class="container">
  <div class="sidebar">
    <img id="poster" src="" alt="بوستر" style="width: 100%; margin-bottom: 10px;">
    <h2 id="ep-title"></h2>
    <table class="download-table" id="download-links"></table>
  </div>

  <div class="content">
    <div class="video-player">
      <iframe id="videoFrame" src="" allowfullscreen></iframe>
    </div>

    <div class="server-buttons" id="server-buttons"></div>

    <div class="subtitles" id="softsubs"></div>
  </div>

  <div class="episodes-list">
    <p style="color:#aaa;">⬅️ ارجع للقائمة الرئيسية</p>
    <a href="index.html" style="color: #00bcd4;">العودة</a>
  </div>
</div>

<script>
  async function loadEpisode() {
    const params = new URLSearchParams(window.location.search);
    const episodeId = params.get("id");
    if (!episodeId) return;

    const res = await fetch('episodes.json');
    const episodes = await res.json();
    const ep = episodes.find(e => e.id === episodeId);
    if (!ep) {
      document.body.innerHTML = '<h1 style="text-align:center;">❌ الحلقة غير موجودة</h1>';
      return;
    }

    document.title = `الحلقة ${ep.id} - Aoibu`;
    document.getElementById('ep-title').textContent = `مشاهدة الحلقة ${ep.id} - ${ep.title}`;
    document.getElementById('poster').src = ep.poster;

    // الفيديو الأول
    document.getElementById('videoFrame').src = ep.videoServers[0].url;

    // أزرار السيرفرات
    const buttonsDiv = document.getElementById('server-buttons');
    ep.videoServers.forEach(s => {
      const btn = document.createElement('button');
      btn.textContent = s.name;
      btn.onclick = () => document.getElementById('videoFrame').src = s.url;
      buttonsDiv.appendChild(btn);
    });

    // روابط التحميل
    const dlTable = document.getElementById('download-links');
    dlTable.innerHTML = `<tr><th>السيرفر</th><th>الجودة</th><th>تحميل</th></tr>`;
    ep.downloads.forEach(d => {
      const row = `<tr><td>${d.server}</td><td>${d.quality}</td><td><a href="${d.url}" target="_blank">Download</a></td></tr>`;
      dlTable.innerHTML += row;
    });

    // ملفات السوفت سب
    const softsubDiv = document.getElementById('softsubs');
    softsubDiv.innerHTML = `<h3>ملفات الترجمة والروابط (SoftSub)</h3>`;
    ep.softsubs.forEach(s => {
      softsubDiv.innerHTML += `<a href="${s.url}" target="_blank">${s.label}</a>`;
    });
  }

  loadEpisode();
</script>

</body>
</html>
